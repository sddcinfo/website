<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansible Bare-Metal Kubernetes Provisioning</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 40px 20px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.8em;
        }
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
        }
        .section {
            background: #fff;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        h2 {
            font-size: 2em;
            color: #3498db;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            margin-top: 0;
        }
        h3 {
            font-size: 1.5em;
            color: #2980b9;
        }
        code {
            background-color: #ecf0f1;
            padding: 3px 6px;
            border-radius: 4px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
        }
        pre {
            background-color: #34495e;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .workflow-step {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .step-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
            margin-right: 20px;
            min-width: 40px;
            text-align: center;
        }
        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9em;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>Ansible Bare-Metal Kubernetes Ecosystem</h1>
        <p>A fully automated solution for provisioning a Kubernetes cluster from scratch.</p>
    </div>

    <div class="container">
        <div class="section">
            <h2>Core Architecture</h2>
            <p>This ecosystem uses a two-part Ansible setup to achieve complete, end-to-end automation. The process begins with a dedicated provisioning server that prepares the environment for bare-metal machines to install their operating system automatically. Once a machine is provisioned, a second Ansible project configures it into a production-ready Kubernetes node.</p>
        </div>

        <div class="section">
            <h2>Part 1: The Provisioning Server</h2>
            <h3>Project: <code>ansible_provisioning_server</code></h3>
            <p>This project configures a central server to provide all necessary services for network booting and unattended OS installation. Its key roles are:</p>
            <ul>
                <li><strong>DHCP & TFTP (dnsmasq, tftpd-hpa):</strong> Listens for new nodes on the network, assigns them IP addresses, and provides the iPXE bootloader.</li>
                <li><strong>HTTP Server (Nginx & PHP):</strong> Serves the main iPXE boot script and all necessary autoinstall configuration files. It also hosts a live HTML status page to monitor the provisioning process.</li>
                <li><strong>NAT Gateway (iptables):</strong> Provides internet access to the internal cluster nodes, allowing them to pull packages and container images.</li>
            </ul>
        </div>

        <div class="section">
            <h2>Part 2: The Kubernetes Cluster</h2>
            <h3>Project: <code>node1-ansible</code></h3>
            <p>After a node has been automatically provisioned with Ubuntu, this project takes over to perform all application-level configuration. It transforms the fresh OS into a fully configured Kubernetes node.</p>
            <ul>
                <li><strong>System Hardening:</strong> Disables IPv6 and configures kernel parameters for container networking.</li>
                <li><strong>Container Runtime:</strong> Installs and configures <code>containerd</code> as the Kubernetes container runtime.</li>
                <li><strong>Kubernetes Components:</strong> Installs the exact version of <code>kubelet</code>, <code>kubeadm</code>, and <code>kubectl</code> required for the cluster.</li>
                <li><strong>Cluster Initialization:</strong> Initializes the control plane on the controller node and joins worker nodes to the cluster.</li>
                <li><strong>Storage Preparation:</strong> Installs prerequisites for a Ceph storage cluster.</li>
            </ul>
        </div>

        <div class="section">
            <h2>The Automated Workflow: Step-by-Step</h2>
            <div class="workflow-step">
                <div class="step-number">1</div>
                <div>
                    <strong>Configure the Provisioner:</strong> You run the <code>ansible-playbook -i inventory site.yml</code> command inside the <code>ansible_provisioning_server</code> directory. This sets up the central server.
                </div>
            </div>
            <div class="workflow-step">
                <div class="step-number">2</div>
                <div>
                    <strong>Power On Nodes:</strong> You power on the bare-metal machines. They automatically PXE boot, get an IP address, and are directed to the provisioning server.
                </div>
            </div>
            <div class="workflow-step">
                <div class="step-number">3</div>
                <div>
                    <strong>Automated OS Installation:</strong> The nodes fetch an iPXE script from the server, which in turn points them to the Ubuntu installer and a unique cloud-init configuration file. The OS installs without any manual input. You can monitor this live at <code>http://10.10.1.1</code>.
                </div>
            </div>
            <div class="workflow-step">
                <div class="step-number">4</div>
                <div>
                    <strong>Configure Kubernetes:</strong> Once the nodes are installed, you run <code>ansible-playbook -i inventory.ini site.yml</code> from the <code>node1-ansible</code> directory. This configures the entire Kubernetes cluster.
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>This documentation was generated automatically to reflect the current state of the Ansible ecosystem.</p>
    </div>

</body>
</html>
